/**
 * sofa-coupon-service - v0.2.0 - 2014-06-24
 * http://www.sofa.io
 *
 * Copyright (c) 2014 CouchCommerce GmbH (http://www.couchcommerce.com / http://www.sofa.io) and other contributors
 * THIS SOFTWARE CONTAINS COMPONENTS OF THE SOFA.IO COUCHCOMMERCE SDK (WWW.SOFA.IO).
 * IT IS PROVIDED UNDER THE LICENSE TERMS OF THE ATTACHED LICENSE.TXT.
 */
!function(a){"use strict";a.define("sofa.CouponService",function(b,c,d,e,f,g){var h={},i={"Content-Type":"application/x-www-form-urlencoded"},j=g.get("checkoutUrl"),k=j+"coupon.php";h.submitCode=function(g){if(!g)return c.reject(new Error("No couponCode given!"));var h={task:"INFO",coupon:g,quote:JSON.stringify(e.createQuoteData())};return b({method:"POST",url:k,headers:i,transformRequest:a.Util.toFormData,data:h}).then(function(a){return a.data.error?c.reject(a.data.error):(d.addCoupon(a.data),a.data)},function(a){return f.error(["[CouponService: submitCode]","[Request Data]",h,"[Service answer]",a]),c.reject(a)})};var l=function(){var a=d.getActiveCoupons(),b=a.map(function(a){return a.code});d.clearCoupons(),b.forEach(function(a){h.submitCode(a)})};return d.on("itemAdded",l).on("itemRemoved",l).on("clear",l),h})}(sofa);